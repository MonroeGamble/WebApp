<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta name="description" content="FranResearch Sports - Live scores and betting odds for NFL, NBA, WNBA, NHL, MLS, and MLB franchise leagues.">
    <meta name="keywords" content="sports franchises, NFL scores, NBA scores, MLB scores, NHL scores, MLS scores, WNBA scores, betting odds">
    <title>Live Sports Dashboard - FranResearch</title>

    <style>
        :root {
            --bg: #0f172a;
            --card: rgba(255,255,255,0.06);
            --text: #f8fafc;
            --secondary: #cbd5e1;
            --accent1: #6366f1;
            --accent2: #a855f7;
            --live: #ef4444;
            --green: #22c55e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            padding-top: 160px;
            padding-bottom: 100px;
        }

        /* Global Stock Ticker at Top */
        .global-ticker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1200;
            background: #0a0a0a;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .global-ticker iframe {
            width: 100%;
            height: 110px;
            border: none;
        }

        /* Navigation Bar */
        .main-nav {
            position: fixed;
            top: 110px;
            left: 0;
            width: 100%;
            z-index: 1100;
            display: flex;
            gap: 24px;
            background: rgba(255,255,255,0.08);
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            overflow-x: auto;
        }

        .main-nav a {
            color: rgba(255,255,255,0.85);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            transition: color 0.2s;
        }

        .main-nav a:hover,
        .main-nav a.active {
            color: #667eea;
        }

        /* Franchisor Filter */
        .franchisor-filter {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 12px 20px;
            background: rgba(0,0,0,0.2);
            align-items: center;
        }

        .franchisor-filter label {
            font-size: 0.9em;
            color: var(--secondary);
            font-weight: 500;
        }

        .franchisor-filter select {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            background: #1e293b;
            color: var(--text);
            cursor: pointer;
            min-width: 200px;
        }

        .franchisor-filter select:focus {
            outline: 2px solid var(--accent1);
        }

        /* Hero Header */
        .sports-hero {
            text-align: center;
            padding: 40px 20px 20px;
            background: linear-gradient(135deg, var(--accent1) 0%, var(--accent2) 100%);
            margin-bottom: 0;
        }

        .sports-hero h1 {
            font-size: 2.2em;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .sports-hero p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* League Tabs */
        .league-tabs {
            display: flex;
            gap: 10px;
            padding: 20px;
            overflow-x: auto;
            background: rgba(0,0,0,0.3);
            justify-content: center;
            flex-wrap: wrap;
        }

        .league-tabs button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: #1e293b;
            color: var(--text);
            white-space: nowrap;
        }

        .league-tabs button:hover {
            background: #334155;
        }

        .league-tabs button.active {
            background: linear-gradient(135deg, var(--accent1) 0%, var(--accent2) 100%);
            color: white;
        }

        .league-tabs button.hidden {
            display: none;
        }

        /* Day Selector */
        .day-selector {
            display: flex;
            gap: 10px;
            padding: 16px 20px;
            overflow-x: auto;
            justify-content: center;
            background: rgba(0,0,0,0.2);
        }

        .day-selector button {
            padding: 10px 18px;
            border: 2px solid #334155;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            color: var(--secondary);
            white-space: nowrap;
        }

        .day-selector button:hover {
            border-color: var(--accent1);
            color: var(--text);
        }

        .day-selector button.active {
            background: var(--accent1);
            border-color: var(--accent1);
            color: white;
        }

        /* Sports Container */
        #sports-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Game Card */
        .game-card {
            background: var(--card);
            padding: 22px;
            border-radius: 14px;
            margin: 22px 0;
            backdrop-filter: blur(14px);
            box-shadow: 0 4px 22px rgba(0,0,0,0.25);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .game-status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .status-text {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--secondary);
        }

        .status-text.live {
            color: var(--live);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .league-tag {
            background: rgba(99, 102, 241, 0.3);
            color: var(--accent1);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .teams-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .team {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .team:last-child {
            flex-direction: row-reverse;
            text-align: right;
        }

        .team-logo {
            width: 42px;
            height: 42px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            object-fit: contain;
        }

        .team-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .team-name {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text);
        }

        .team-record {
            font-size: 0.85em;
            color: var(--secondary);
        }

        .team-score {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--text);
            min-width: 50px;
            text-align: center;
        }

        .team-score.winner {
            color: var(--green);
        }

        .odds-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 120px;
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }

        .odds-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
        }

        .odds-row label {
            color: var(--secondary);
        }

        .odds-row span {
            color: var(--text);
            font-weight: 600;
        }

        /* Empty Message */
        .empty-msg {
            text-align: center;
            padding: 60px 20px;
            color: var(--secondary);
        }

        .empty-msg h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: var(--text);
        }

        /* Loading */
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--accent1);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        #site-footer {
            text-align: center;
            padding: 30px 20px;
            background: rgba(0,0,0,0.3);
            margin-top: 40px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        #site-footer a {
            color: var(--accent1);
            text-decoration: none;
        }

        #site-footer a:hover {
            text-decoration: underline;
        }

        /* Fixed Bottom News Ticker */
        .news-ticker-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 999;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sports-hero h1 {
                font-size: 1.8em;
            }

            .teams-row {
                flex-direction: column;
                gap: 15px;
            }

            .team, .team:last-child {
                flex-direction: row;
                text-align: left;
                width: 100%;
                justify-content: space-between;
            }

            .odds-column {
                width: 100%;
            }

            .league-tabs {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Global Stock Ticker -->
    <div class="global-ticker">
        <iframe src="Website/ticker.html" title="Franchise stock ticker" loading="lazy"></iframe>
    </div>

    <!-- Navigation Bar -->
    <nav class="main-nav">
        <a href="index.html">Home</a>
        <a href="Website/ticker.html">Stock Ticker</a>
        <a href="StockChart/chart.html">Stock Charts</a>
        <a href="FranchiseMap/map.html">Franchise Map</a>
        <a href="FranchiseNews/news-feed.html">News</a>
        <a href="sports.html" class="active">Sports</a>
        <a href="franchise_calculators_module/index.html">Calculators</a>
        <a href="about.html">About</a>
    </nav>

    <!-- Hero Header -->
    <header class="sports-hero">
        <h1>Live Sports Dashboard</h1>
        <p>Real-time franchise league scores and betting odds</p>
    </header>

    <!-- League Tabs -->
    <nav class="league-tabs" id="league-tabs">
        <button data-league="NFL" class="active">NFL</button>
        <button data-league="NBA">NBA</button>
        <button data-league="WNBA">WNBA</button>
        <button data-league="NHL">NHL</button>
        <button data-league="MLS">MLS</button>
        <button data-league="MLB">MLB</button>
    </nav>

    <!-- Franchisor Filter -->
    <div class="franchisor-filter">
        <label for="franchisor-select">Filter by Franchisor:</label>
        <select id="franchisor-select">
            <option value="all">All Teams</option>
            <optgroup label="NFL Teams">
                <option value="Patriots">New England Patriots</option>
                <option value="Cowboys">Dallas Cowboys</option>
                <option value="Chiefs">Kansas City Chiefs</option>
                <option value="Packers">Green Bay Packers</option>
                <option value="49ers">San Francisco 49ers</option>
            </optgroup>
            <optgroup label="NBA Teams">
                <option value="Lakers">Los Angeles Lakers</option>
                <option value="Celtics">Boston Celtics</option>
                <option value="Warriors">Golden State Warriors</option>
                <option value="Bulls">Chicago Bulls</option>
                <option value="Heat">Miami Heat</option>
            </optgroup>
            <optgroup label="NHL Teams">
                <option value="Bruins">Boston Bruins</option>
                <option value="Rangers">New York Rangers</option>
                <option value="Maple Leafs">Toronto Maple Leafs</option>
                <option value="Blackhawks">Chicago Blackhawks</option>
            </optgroup>
            <optgroup label="MLB Teams">
                <option value="Yankees">New York Yankees</option>
                <option value="Red Sox">Boston Red Sox</option>
                <option value="Dodgers">Los Angeles Dodgers</option>
                <option value="Cubs">Chicago Cubs</option>
            </optgroup>
        </select>
    </div>

    <!-- Day Selector -->
    <div class="day-selector" id="day-selector"></div>

    <!-- Game List -->
    <section id="sports-container">
        <div class="loading-state">
            <div class="spinner"></div>
            <p>Loading sports data...</p>
        </div>
    </section>

    <!-- Footer -->
    <footer id="site-footer">
        <p>&copy; 2024 FranResearch Sports. <a href="index.html">Back to Main Site</a></p>
        <p style="margin-top: 10px; font-size: 0.9em; color: var(--secondary);">
            Data provided by TheSportsDB API | Updates every 60 seconds
        </p>
    </footer>

    <!-- Fixed Bottom News Ticker -->
    <div id="franchise-news-ticker-bottom" class="news-ticker-bottom"></div>

    <!-- News Widget Scripts -->
    <script src="FranchiseNews/newsService.js"></script>
    <script src="FranchiseNews/news-widget.js"></script>

    <script>
        // League configuration with API sport names
        const LEAGUES = {
            NFL: { sport: 'American Football', league: 'NFL', icon: 'üèà' },
            NBA: { sport: 'Basketball', league: 'NBA', icon: 'üèÄ' },
            WNBA: { sport: 'Basketball', league: 'WNBA', icon: 'üèÄ' },
            NHL: { sport: 'Ice Hockey', league: 'NHL', icon: 'üèí' },
            MLS: { sport: 'Soccer', league: 'MLS', icon: '‚öΩ' },
            MLB: { sport: 'Baseball', league: 'MLB', icon: '‚öæ' }
        };

        const API_BASE = 'https://www.thesportsdb.com/api/v1/json/3';

        let currentLeague = 'NFL';
        let currentDate = new Date();
        let gamesCache = {};
        let leaguesWithGames = new Set();
        let currentFranchisor = 'all';

        // Format time to 12-hour EST
        function formatTimeEST(dateStr, timeStr) {
            if (!dateStr) return 'TBD';

            try {
                const dateTime = timeStr ? `${dateStr}T${timeStr}` : dateStr;
                const date = new Date(dateTime);

                if (isNaN(date.getTime())) return timeStr || 'TBD';

                // Convert to EST
                const options = {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true,
                    timeZone: 'America/New_York'
                };

                return date.toLocaleTimeString('en-US', options) + ' EST';
            } catch (e) {
                return timeStr || 'TBD';
            }
        }

        // Format date for display
        function formatDateShort(date) {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}`;
        }

        // Get date string for API
        function getDateString(date) {
            return date.toISOString().split('T')[0];
        }

        // Generate 7-day date buttons
        function generateDaySelector() {
            const container = document.getElementById('day-selector');
            container.innerHTML = '';

            const today = new Date();

            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);

                const btn = document.createElement('button');
                btn.textContent = i === 0 ? 'Today' : i === 1 ? 'Tomorrow' : formatDateShort(date);
                btn.dataset.date = getDateString(date);

                if (i === 0) btn.classList.add('active');

                btn.addEventListener('click', () => {
                    document.querySelectorAll('.day-selector button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentDate = date;
                    renderGames();
                });

                container.appendChild(btn);
            }
        }

        // Fetch events for a specific date and sport
        async function fetchEvents(sport, date) {
            const dateStr = getDateString(date);
            const cacheKey = `${sport}-${dateStr}`;

            if (gamesCache[cacheKey]) {
                return gamesCache[cacheKey];
            }

            try {
                const url = `${API_BASE}/eventsday.php?d=${dateStr}&s=${encodeURIComponent(sport)}`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const events = data?.events || [];

                gamesCache[cacheKey] = events;
                return events;
            } catch (error) {
                console.error(`Error fetching ${sport} events:`, error);
                return [];
            }
        }

        // Check which leagues have games in the next 7 days
        async function checkLeaguesWithGames() {
            const today = new Date();
            const checks = [];

            for (const [leagueKey, config] of Object.entries(LEAGUES)) {
                for (let i = 0; i < 7; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);

                    checks.push(
                        fetchEvents(config.sport, date).then(events => {
                            const leagueEvents = events.filter(e =>
                                (e.strLeague || '').toUpperCase().includes(leagueKey)
                            );
                            if (leagueEvents.length > 0) {
                                leaguesWithGames.add(leagueKey);
                            }
                        })
                    );
                }
            }

            await Promise.all(checks);
            updateLeagueTabs();
        }

        // Update league tabs visibility
        function updateLeagueTabs() {
            document.querySelectorAll('.league-tabs button').forEach(btn => {
                const league = btn.dataset.league;
                // Always show NFL, NBA, NHL as they typically have active seasons
                const alwaysShow = ['NFL', 'NBA', 'NHL'];
                if (leaguesWithGames.has(league) || alwaysShow.includes(league)) {
                    btn.classList.remove('hidden');
                }
            });
        }

        // Normalize game status
        function normalizeStatus(event) {
            const status = (event.strStatus || event.strProgress || '').toLowerCase();
            if (status.includes('final') || status.includes('ft') || status.includes('aet')) return 'FINAL';
            if (status.includes('live') || status.includes('progress') || status.includes('ht')) return 'LIVE';
            if (status.includes('postponed')) return 'POSTPONED';
            if (status.includes('cancelled') || status.includes('canceled')) return 'CANCELLED';
            return 'UPCOMING';
        }

        // Build game card HTML
        function buildGameCard(game, leagueKey) {
            const config = LEAGUES[leagueKey];
            const status = normalizeStatus(game);
            const homeScore = parseInt(game.intHomeScore) || 0;
            const awayScore = parseInt(game.intAwayScore) || 0;
            const isLive = status === 'LIVE';
            const isFinal = status === 'FINAL';

            const homeWinner = isFinal && homeScore > awayScore;
            const awayWinner = isFinal && awayScore > homeScore;

            const statusText = isLive ? 'LIVE' :
                               isFinal ? 'FINAL' :
                               status === 'POSTPONED' ? 'POSTPONED' :
                               status === 'CANCELLED' ? 'CANCELLED' :
                               formatTimeEST(game.dateEvent, game.strTime);

            return `
                <div class="game-card">
                    <div class="game-status-bar">
                        <span class="status-text ${isLive ? 'live' : ''}">${statusText}</span>
                        <span class="league-tag">${config.icon} ${leagueKey}</span>
                    </div>

                    <div class="teams-row">
                        <div class="team">
                            <img src="${game.strAwayTeamBadge || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23334155%22 width=%22100%22 height=%22100%22/></svg>'}"
                                 alt="${game.strAwayTeam}"
                                 class="team-logo"
                                 onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23334155%22 width=%22100%22 height=%22100%22/></svg>'">
                            <div class="team-info">
                                <div class="team-name">${game.strAwayTeam || 'Away Team'}</div>
                            </div>
                            ${(isLive || isFinal) ? `<div class="team-score ${awayWinner ? 'winner' : ''}">${awayScore}</div>` : ''}
                        </div>

                        <div class="odds-column">
                            <div class="odds-row">
                                <label>Spread:</label>
                                <span>‚Äì</span>
                            </div>
                            <div class="odds-row">
                                <label>O/U:</label>
                                <span>‚Äì</span>
                            </div>
                            <div class="odds-row">
                                <label>Venue:</label>
                                <span style="font-size: 0.8em;">${game.strVenue ? game.strVenue.substring(0, 15) : '‚Äì'}</span>
                            </div>
                        </div>

                        <div class="team">
                            <img src="${game.strHomeTeamBadge || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23334155%22 width=%22100%22 height=%22100%22/></svg>'}"
                                 alt="${game.strHomeTeam}"
                                 class="team-logo"
                                 onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23334155%22 width=%22100%22 height=%22100%22/></svg>'">
                            <div class="team-info">
                                <div class="team-name">${game.strHomeTeam || 'Home Team'}</div>
                            </div>
                            ${(isLive || isFinal) ? `<div class="team-score ${homeWinner ? 'winner' : ''}">${homeScore}</div>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // Render games for current league and date
        async function renderGames() {
            const container = document.getElementById('sports-container');
            const config = LEAGUES[currentLeague];

            container.innerHTML = `
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading ${currentLeague} games...</p>
                </div>
            `;

            try {
                const events = await fetchEvents(config.sport, currentDate);

                // Filter for the specific league
                let leagueGames = events.filter(e => {
                    const league = (e.strLeague || '').toUpperCase();
                    return league.includes(currentLeague);
                });

                // Filter by franchisor if selected
                if (currentFranchisor !== 'all') {
                    leagueGames = leagueGames.filter(e => {
                        const homeTeam = (e.strHomeTeam || '').toLowerCase();
                        const awayTeam = (e.strAwayTeam || '').toLowerCase();
                        const filter = currentFranchisor.toLowerCase();
                        return homeTeam.includes(filter) || awayTeam.includes(filter);
                    });
                }

                if (leagueGames.length === 0) {
                    container.innerHTML = `
                        <div class="empty-msg">
                            <h3>No ${currentLeague} games scheduled</h3>
                            <p>Check back on active game days for real-time franchise scores.</p>
                        </div>
                    `;
                    return;
                }

                // Sort by time
                leagueGames.sort((a, b) => {
                    const timeA = a.strTime || '00:00';
                    const timeB = b.strTime || '00:00';
                    return timeA.localeCompare(timeB);
                });

                container.innerHTML = leagueGames.map(game => buildGameCard(game, currentLeague)).join('');

            } catch (error) {
                console.error('Error rendering games:', error);
                container.innerHTML = `
                    <div class="empty-msg">
                        <h3>Unable to load games</h3>
                        <p>Please try again later.</p>
                    </div>
                `;
            }
        }

        // Set up league tab click handlers
        function setupLeagueTabs() {
            document.querySelectorAll('.league-tabs button').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.league-tabs button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentLeague = btn.dataset.league;
                    renderGames();
                });
            });
        }

        // Initialize news ticker
        async function initNewsTicker() {
            try {
                if (window.FranchiseNewsWidget) {
                    await window.FranchiseNewsWidget.initTicker({
                        mountSelector: '#franchise-news-ticker-bottom',
                        categories: [
                            window.NEWS_CATEGORIES.TRADE_PRESS,
                            window.NEWS_CATEGORIES.BIG_PORTALS
                        ],
                        tickerSpeed: 90,
                        pauseOnHover: true,
                        showLabel: true,
                        labelText: 'Franchise News',
                        labelIcon: ''
                    });
                }
            } catch (error) {
                console.error('Failed to initialize news ticker:', error);
            }
        }

        // Setup franchisor filter
        function setupFranchisorFilter() {
            const franchisorSelect = document.getElementById('franchisor-select');
            if (franchisorSelect) {
                franchisorSelect.addEventListener('change', (e) => {
                    currentFranchisor = e.target.value;
                    renderGames();
                });
            }
        }

        // Initialize app
        async function init() {
            generateDaySelector();
            setupLeagueTabs();
            setupFranchisorFilter();

            // Check leagues with games in background
            checkLeaguesWithGames();

            // Load initial games
            await renderGames();

            // Initialize news ticker
            initNewsTicker();

            // Refresh every 60 seconds
            setInterval(() => {
                gamesCache = {}; // Clear cache
                renderGames();
            }, 60000);
        }

        // Start
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
